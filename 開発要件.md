# 開発要件書

## 1. プロジェクト概要
- サービス名（仮）: まことクラブ フロントエンド
- 目的: 全国の風俗店で働く風俗嬢が、実際の店舗レビューを基に最適な勤務先を選べるようにする情報メディアを構築する。
- 背景データ: 既に収集済みの約500件の匿名店舗アンケート（レビュー）を初期コンテンツとする。

## 2. 想定ユーザーと価値提供
- 想定ユーザー: 新しい勤務先を検討している風俗嬢。
- 提供価値: 実体験に基づくレビュー検索、比較、詳細閲覧、口コミ投稿を通じて、店舗情報の透明性を高める。

## 3. 主要機能
- 店舗レビュー検索・一覧表示（都道府県・業種・平均稼ぎでフィルタリング）。
- レビュー詳細ページの閲覧。
- レビュー投稿フォーム（LINE OAuth 認証後に投稿可）。
- トップページでの新着レビュー/高評価レビューのハイライト表示。
- 公式 LINE 連携導線（「相談はこちら」ボタン）。

## 4. 画面構成
### 4.1 共通UI
- スマートフォンファーストのレスポンシブ対応（タブレット/PCは拡張対応）。
- ヘッダー: 媒体名「まことクラブ」、ハンバーガーメニュー、`相談はこちら`（LINEログインボタン）。
- ハンバーガーメニュー項目: 店舗一覧 / アンケート一覧 / アンケート投稿。
- フッター: 利用規約、プライバシーポリシー、問い合わせ（削除依頼）リンク。
- トーン: フランクでポップ。UIはカラフルで親しみやすい方向性（詳細なブランドカラーは未定）。

### 4.2 トップページ
- 検索セクション: 都道府県・業種・平均稼ぎで絞り込めるフォーム。
- 新着口コミ: 最新レビューを3件表示。
- 高評価口コミ: 「役に立った」指標などで高評価のレビューを3件表示（将来的に評価機能拡張を想定）。
- Twitter宣伝枠: 静的コンテンツをベタ貼り。
- キャッシュバック／キャンペーン告知: 静的コンテンツ。

### 4.3 店舗一覧ページ
- 都道府県別に店舗を閲覧可能な一覧。
- 1ページあたり10件表示。ページネーション方式（次へ/前へ）。
- フィルタリング条件: 都道府県、業種、平均稼ぎ。

### 4.4 アンケート（レビュー）一覧ページ
- 最新順または検索結果に基づいたレビュー表示。
- 1ページ10件、抜粋（店舗名、時期、平均稼ぎ、サマリー）を表示。

### 4.5 レビュー詳細ページ
- レビュー1件につき専用ページを生成。
- 表示項目: 店舗名、時期、年齢、スペック、待機時間、平均稼ぎ、自由記述がある場合は本文（将来拡張を想定）。
- 関連レビューや同じ店舗の他レビューへの導線。

### 4.6 アンケート投稿ページ
- LINE OAuth 認証済みでのみアクセス可。
- フォームバリデーション（React Hook Form 等を想定）。
- 入力項目は選択肢中心で、ユーザーの入力負荷を軽減。

## 5. 検索・フィルタ仕様
- 絞り込み条件
  - 都道府県（47都道府県プルダウン）。
  - 業種: 店舗型ヘルス / 出張型ヘルス / ソープ / デリヘル（DC） / ピンサロ。
  - 平均稼ぎ: 0〜20の数値選択（単位: 万円想定。詳細はバックエンドと同期）。
- 並び替え: 初期は新着順。将来的に平均稼ぎ順など拡張予定。
- 実装方針: 基本はSSR/SSGで初期表示し、検索条件変更時はクエリパラメータ付きの再リクエスト（Next.js のサーバーコンポーネント + fetch）。必要に応じてクライアントサイドで遅延ローディング。

## 6. レビュー投稿仕様
- 認証: 投稿前にLINE OAuthを必須化。セッションストレージにアクセストークン/ユーザー情報を保持し、投稿APIに添付。
- 入力項目（必須）
  - 店舗名（テキスト）
  - 時期（テキスト、例: 2025年9月）
  - 年齢（セレクト: 18〜60 歳程度の整数を選択肢化）
  - スペック（セレクト: 80未満、80〜120を10刻み、120以上）
  - 待機時間（セレクト: 1〜24 時間）
  - 平均稼ぎ（セレクト: 0〜20 ※単位万を想定）
- 入力補助: 必須項目のバリデーション、未入力時のポップな警告メッセージ。
- 投稿完了後: 感謝メッセージ＋LINEでPayPay 1000円送付の案内（静的テキストで可）。

## 7. データモデル（フロント側）
```ts
type ReviewCategory = 'store_health' | 'delivery_health' | 'soap' | 'dc' | 'pinsaro';

interface ReviewSummary {
  id: string;
  storeName: string;
  prefecture: string;
  category: ReviewCategory;
  visitedAt: string;          // ISO8601 または YYYY-MM 形式
  age: number;
  specScore: number;          // 80, 90, …, 120 (120超は 120 として扱う)
  waitTimeHours: number;      // 1〜24
  averageEarning: number;     // 0〜20（単位: 万円）
  createdAt: string;          // 投稿日
  helpfulCount?: number;      // 将来の役に立った数
}

interface ReviewDetail extends ReviewSummary {
  description?: string;       // 将来的な自由記述欄
  authorDisplayName?: string; // 必要に応じて表示（初期は非表示想定）
}
```

## 8. API 仕様（提案）
バックエンドは Go (chi) マイクロサービス構成。`auth-service` は LINE OAuth を担当。レビュー関連APIは別サービスを想定。

### 8.1 認証
- `GET /line/login`: LINE 認証ページへリダイレクト。
- `GET /line/callback`: LINE OAuth コールバック。`auth-service` がトークンとユーザー情報を取得し、フロントへリダイレクトしつつクエリまたは一時コードを渡す。
- `POST /auth/session/exchange`: フロントが一時コードを送付し、セッション用トークンを受け取る。レスポンス例:
  ```json
  {
    "accessToken": "string",
    "lineUser": {
      "userId": "string",
      "displayName": "string",
      "avatarUrl": "https://..."
    }
  }
  ```
- フロントは `accessToken` と `lineUser` を `sessionStorage` に保存。投稿API呼び出し時に `Authorization: Bearer <token>` を付与。

### 8.2 レビューAPI
- `GET /api/reviews`
  - クエリ: `prefecture?`, `category?`, `avgEarningMin?`, `avgEarningMax?`, `page?`, `limit?`（デフォルト10）。
  - レスポンス:
    ```json
    {
      "items": [ReviewSummary],
      "page": 1,
      "limit": 10,
      "total": 123
    }
    ```
- `GET /api/reviews/{id}` → `ReviewDetail`
- `GET /api/reviews/new` → 最新3件
- `GET /api/reviews/high-rated` → 高評価3件（暫定で平均稼ぎなどの指標に基づきサーバーが選定）
- `POST /api/reviews`
  - 認証必須。Body に投稿内容（上記入力項目）をJSONで送付。
  - レスポンス: 作成済み `ReviewDetail`
- 役に立った機能は将来拡張（例: `POST /api/reviews/{id}/helpful`）。

## 9. 認証・セキュリティ
- 投稿ページにアクセスする際、`sessionStorage` のトークン有無でガード。未認証の場合はLINEログイン導線へ。
- SSR/SSG ページではセッション情報が参照できないため、投稿ページはクライアントサイドでトークン確認を実施。
- API はトークン検証を行い、`lineUserId` とレビューを紐付ける。複数投稿は同じ `lineUserId` に紐付けて許可。

## 10. 技術スタック & 開発ルール
- Next.js App Router (TypeScript) on Vercel。
- スタイリング: Tailwind CSS。
- フォーム: React Hook Form（想定）。
- Lint/Format: ESLint + Prettier（デフォルトルールをベースに、必要に応じてTailwindプラグイン等を導入）。
- データ取得: `fetch` API（Next.js のサーバーコンポーネント/Route Handler活用）。
- デプロイ先: Vercel（予定）。
- 国際化: 当面日本語のみ。

## 11. UX・コンテンツ指針
- UIテキストはフランクでポップ。例: 「さくっと検索」「これが最新のリアル口コミ」。
- エラーメッセージもやさしいトーンで: 例「入力漏れがあるよ！もう一度チェックしてね」。
- 投稿完了後にPayPay受け取りフローへの案内を表示。

## 12. 未決定事項・ToDo
- ブランドカラー、フォント、ロゴ等のビジュアル確定。
- 平均稼ぎの正確な単位と表示フォーマット（例: 万円/千円）。
- LINE OAuth 後のPayPay送付処理フローの詳細（誰がどこで完了判定するか）。
- 役に立ったボタン実装のタイミングとバックエンド仕様。
- サイトマップやSEO対応（必要になったタイミングで検討）。
- 利用規約/プライバシーポリシー/問い合わせページの文言作成。

---
本要件書をベースに Next.js + Tailwind + ESLint/Prettier でプロジェクトを初期化し、順次ページ実装・API連携を進める。
